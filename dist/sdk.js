!function(t,e){for(var r in e)t[r]=e[r]}(window,function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n=class{constructor(){this.handlers={}}on(t,e){return this.handlers[t]=this.handlers[t]||[],this.handlers[t].push(e),this.handlers[t]}off(t){this.handlers[t]&&delete this.handlers[t]}trigger(t,e){let r=e||[],n=this.handlers[t];return!n||n.every(t=>!1!==t.apply(this,r))}};const o={typeDecide:function(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"},serializeObj:function(t){let e="";return Object.keys(t).forEach(r=>{o.typeDecide(t[r],"Object")?e+=r+"="+o.stringify(t[r]):e+=r+"="+t[r]+"^"}),encodeURIComponent(e.substr(0,e.length-1))},stringify:function(t){if(window.JSON&&window.JSON.stringify)return JSON.stringify(t);var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var r,n,o=[],i=t&&t.constructor==Array,s=arguments.callee;for(r in t)t.hasOwnProperty(r)&&(e=typeof(n=t[r]),t.hasOwnProperty(r)&&("string"==e?n='"'+n+'"':"object"==e&&null!==n&&(n=s(n)),o.push((i?"":'"'+r+'":')+String(n))));return(i?"[":"{")+String(o)+(i?"]":"}")},assignObject:function(t,e){for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}};var i=o;var s=class extends n{constructor(t){if(super(),this.config=i.assignObject({dataKey:"",mergeReport:!0,delay:1e3,url:"",getPath:"",postPath:"",random:1,defaultMethod:"get",performanceReport:!1,errorReport:!1},t),this.queue={get:[],post:[]},this.getUrl=this.config.url+this.config.getPath,this.postUrl=this.config.url+this.config.postPath,this.config.performanceReport){const t=window.onload;window.onload=(e=>{t&&"function"==typeof t&&t(e),window.requestIdleCallback?window.requestIdleCallback(this.performanceReport.bind(this)):setTimeout(this.performanceReport)})}this.config.errorReport&&(console.log("执行异常上报"),this.errorReport.apply(this))}report(t,e){e?this.instantlyReport(this.config.defaultMethod,t):this.sendData(this.config.defaultMethod,t)}reportByGet(t,e){e?this.instantlyReport("get",t):this.sendData("get",t)}reportByPost(t,e){e?this.instantlyReport("post",t):this.sendData("post",t)}instantlyReport(t,e){this[t+"Request"](i.serializeObj(e))}sendData(t,e){this.catchData(t,e)&&this.delayReport()}delayReport(t){let e=this.config.mergeReport?this.config.delay:0;setTimeout(()=>{this.reportSend(t)},e)}catchData(t,e){return!(Math.random()>=this.config.random)&&(this.queue[t].push(e),this.queue[t])}reportSend(t){Promise.all([this.getRequest(),this.postRequest()]).then(e=>{this.trigger("afterReport"),t&&t.call(this,e)})}getRequest(t){return new Promise(e=>{if(0!==this.queue.get.length||t){const r=t||this._getParames("get");let n=this.getUrl+"?"+this.config.dataKey+"="+r,o=new window.Image;o.onload=(()=>{e(r)}),o.src=n}else e()})}postRequest(t){return new Promise(e=>{if(0!==this.queue.post.length||t){const r=t||this._getParames("post"),n=new XMLHttpRequest;n.onreadystatechange=(()=>{4==n.readyState&&200==n.status&&e(r)}),n.open("POST",this.postUrl,!0),n.setRequestHeader("Content-Type","application/json");const o={};o[this.config.dataKey]=r,n.send(JSON.stringify(o))}else e()})}_getParames(t){const e=this.queue[t];let r=this.config.mergeReport,n=r?e:[e.shift()];return r&&(this.queue[t]=[]),n.map(t=>i.serializeObj(t)).join("|")}isFunction(t){}performanceReport(){let t,e=performance.getEntriesByType("navigation")[0],r={reportType:"performance"};for(t in e)"number"==typeof e[t]?r[t]=e[t].toFixed(2):"string"==typeof e[t]&&(r[t]=e[t]);this.queue.get.push()}errorReport(){window.onerror=function(t,e){console.log(arguments)}}};window.Monitor=s}]));